<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login ‚Äì Sipyora Institute</title>
  <link rel="stylesheet" href="css/style.css"/>
</head>
<body class="login-page">

  <div class="toast-container"></div>

  <div class="login-card">
    <div class="login-logo">
      <h1>Sip<span>yora</span></h1>
      <p>Institute Management System</p>
    </div>

    <div class="role-tabs">
      <button class="role-tab active" onclick="setRole('admin')">üîê Admin</button>
      <button class="role-tab" onclick="setRole('teacher')">üë©‚Äçüè´ Teacher</button>
    </div>

    <div id="loginForm">
      <div class="form-group">
        <label>Email Address</label>
        <input type="email" id="emailInput" placeholder="Enter your email" />
      </div>
      <div class="form-group">
        <label>Password</label>
        <input type="password" id="passwordInput" placeholder="Enter your password"
          onkeydown="if(event.key==='Enter') doLogin()" />
      </div>
      <div id="loginError" style="color:var(--danger);font-size:0.85rem;margin-bottom:14px;display:none;"></div>
      <button class="btn btn-primary" onclick="doLogin()" id="loginBtn">Sign In</button>
    </div>
  </div>

  <!-- Firebase SDKs (compat) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  
  <!-- ONLY load firebase.js, NOT auth.js -->
  <script src="js/firebase.js"></script>

  <script>
    var selectedRole = 'admin';

    function setRole(role) {
      selectedRole = role;
      var tabs = document.querySelectorAll('.role-tab');
      tabs[0].classList.toggle('active', role === 'admin');
      tabs[1].classList.toggle('active', role === 'teacher');
    }

    // Helper function to check admin email
    function isAdmin(email) {
      return email === 'admin@sipyora.com' || email.includes('admin');
    }

    function doLogin() {
      var email = document.getElementById('emailInput').value.trim();
      var password = document.getElementById('passwordInput').value;
      var errEl = document.getElementById('loginError');
      var btn = document.getElementById('loginBtn');

      if (!email || !password) {
        errEl.textContent = 'Please fill in all fields.';
        errEl.style.display = 'block';
        return;
      }
      
      if (selectedRole === 'admin' && !isAdmin(email)) {
        errEl.textContent = 'This email is not registered as admin.';
        errEl.style.display = 'block';
        return;
      }

      btn.textContent = 'Signing in...';
      btn.disabled = true;
      errEl.style.display = 'none';

      // Use the global auth from firebase.js
      auth.signInWithEmailAndPassword(email, password)
        .then(function() {
          window.location.href = 'index.html';
        })
        .catch(function(e) {
          errEl.textContent = e.message || 'Login failed.';
          errEl.style.display = 'block';
          btn.textContent = 'Sign In';
          btn.disabled = false;
        });
    }

    // Redirect if already logged in
    auth.onAuthStateChanged(function(user) {
      if (user) window.location.href = 'index.html';
    });
  </script>
</body>
</html>